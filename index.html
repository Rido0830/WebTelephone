<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SkyWay v4 通話デモ</title>
</head>
<body>
  <h1>SkyWay v4 通話デモ</h1>
  <p>あなたのID: <span id="my-id"></span></p>
  <audio id="remoteAudio" autoplay></audio>

  <script type="module">
    import { SkyWayContext, SkyWayRoom } from "https://cdn.jsdelivr.net/npm/@skyway-sdk/room/dist/skyway-room.esm.js";

    (async () => {
      // コンテキスト作成
      const context = await SkyWayContext.Create({
        apiKey: "10232c12-2b1d-4bcb-b424-944877352c03" // ←アプリケーションID
      });

      // 自分のPerson作成
      const me = await context.createLocalPerson();
      document.getElementById("my-id").textContent = me.id;

      // マイク取得
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

      // ルーム参加
      const room = await SkyWayRoom.FindOrCreate(context, { type: "p2p" });
      await room.join(me);
      await me.publish(stream);

      // 相手の音声を再生
      room.onStreamSubscribed.add(({ stream }) => {
        document.getElementById("remoteAudio").srcObject = stream;
      });
    })();
  </script>
</body>
</html>
